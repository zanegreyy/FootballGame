<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Burrito Room</title>
    <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="football_pong_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="module">
        import { db, doc, setDoc } from './src/firebase/firebase.js';
    
        window.onTelegramAuth = async function(user) {
            console.log('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');
    
            try {
                const playerRef = doc(db, 'players', user.id.toString());
    
                await setDoc(playerRef, {
                    firstName: user.first_name,
                    lastName: user.last_name,
                    username: user.username || null,
                    photoUrl: user.photo_url || null,
                    authDate: user.auth_date,
                    lastLogin: new Date().toISOString(),
                    goalBits: 0  // Initialize in-game currency
                }, { merge: true });
    
                console.log('Player data saved successfully');
                alert('Login successful!');
    
            } catch (error) {
                console.error('Error saving player data:', error);
                alert('There was an error logging in. Please try again.');
            }
        };
    </script>
</head>
<body>
    <h1>Burrito Safe Space</h1>
    <a href="index.html">Back to Game</a>

    <h2>Goalbits</h2>
    <p>Goalbits are our in game currency which allows for in game purchases! These are won in game, and can be accured by making an account.</p>

    <h2>Burrito Prize</h2>
    <p>Beat all of our levels, and win a burrito NFT!</p>
    <p>Log in with your TON Keeper Wallet in order to claim this Jetton!</p>
    <h3>Log in by Telegram</h3>
    <div id="telegram-login-button"></div>
   

    <h3>Nft Collection</h3>
    <p><a href="page2.html">Collect your NFT here </a></p>


</body>
</html>